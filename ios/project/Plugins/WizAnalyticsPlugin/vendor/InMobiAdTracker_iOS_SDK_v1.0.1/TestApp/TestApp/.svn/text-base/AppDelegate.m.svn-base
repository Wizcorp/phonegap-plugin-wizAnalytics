

#import "AppDelegate.h"
#import "ViewController.h"
/**
 * InMobiAdTracker:
 * Download the InMobiAdTracker iOS SDK and import the all the header files here.
 */
#import "IMAdTrackerAnalytics.h"
#import "IMAdTrackerUtil.h"

/**
 * InMobiAdTracker:
 * Register on the InMobi Ad Tracker site as developer and get your App ID.
 * Replace XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX below by that App ID.
 * Also make sure that you change this same App ID in your URL Scheme as well. (Your Info.plist file)
 */
#define IMAdTrackerAppID @"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

@implementation AppDelegate

@synthesize window = _window;
@synthesize viewController = _viewController;

/**
 * InMobiAdTracker:
 * handleOpenURL: and openURL: is mandatory to implement the way given below
 * so as to receive the callback from the browser.
 */
- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url
{
    return [[IMAdTrackerAnalytics imAnalytics] handleOpenURL:url];
}
- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation {
    return [[IMAdTrackerAnalytics imAnalytics] handleOpenURL:url];
}

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    /**
     * InMobiAdTracker:
     * The next line is needed if you are debugging the SDK.
     * You can also set different log levels for debugging; take a look at SDTUtil.h file.
     */
    [IMAdTrackerUtil setLogLevel:IMAdTrackerLogLevelDebug];
    
    /**
     * InMobiAdTracker:
     * You need to start the session before reporting any event, so do it here.
     */
    [[IMAdTrackerAnalytics imAnalytics] startSession:IMAdTrackerAppID];
    /**
     * InMobiAdTracker:
     * After the app launches, this will open up safari browser (if it finds internet connectivity)
     * which sends the app install event to InMobi Ad Tracker.
     * This will happen only once in the app lifetime.
     */
    [[IMAdTrackerAnalytics imAnalytics] reportEvent:IM_GOAL_INSTALL];
    
    // --- Your code from here on --- //
    self.window = [[[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]] autorelease];
    self.viewController = [[[ViewController alloc] init] autorelease];
    
    self.window.rootViewController = self.viewController;
    [self.window makeKeyAndVisible];
    
    return YES;
}

- (void)applicationWillEnterForeground:(UIApplication *)application
{
    /**
     * InMobiAdTracker:
     * Report the App install here also - when the application enters foreground.
     */
    [[IMAdTrackerAnalytics imAnalytics] reportEvent:IM_GOAL_INSTALL];
}


- (void)applicationWillResignActive:(UIApplication *)application {
}
- (void)applicationDidEnterBackground:(UIApplication *)application {
}
- (void)applicationDidBecomeActive:(UIApplication *)application {
}
- (void)applicationWillTerminate:(UIApplication *)application {
}

- (void)dealloc
{
    [_window release];
    [_viewController release];
    [super dealloc];
}

@end
